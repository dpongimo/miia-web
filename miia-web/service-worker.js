!function(){"use strict";const e=[{pattern:/^\/$/},{pattern:/^\/blog\/?$/},{pattern:/^\/blog\/([^\/]+?)\/?$/},{pattern:/^\/tags\/?$/}],t={API_VERSION:"/api_version",SESSION_KEY:"/session_key",REQUEST_NEW_PERMISSIONS:"/request_new_permissions",VERIFY_ACCESS_KEY:"/verify_access_key",ADD_FILE:"/add_files/add_file",CLEAN_TAGS:"/add_tags/clean_tags",GET_TAG_SERVICES:"/add_tags/get_tag_services",ADD_TAGS:"/add_tags/add_tags",GET_URL_FILES:"/add_urls/get_url_files",GET_URL_INFO:"/add_urls/get_url_info",ADD_URL:"/add_urls/add_url",ASSOCIATE_URL:"/add_urls/associate_url",GET_COOKIES:"/manage_cookies/get_cookies",SET_COOKIES:"/manage_cookies/set_cookies",GET_PAGES:"/manage_pages/get_pages",GET_PAGE_INFO:"/manage_pages/get_page_info",FOCUS_PAGE:"/manage_pages/focus_page",SEARCH_FILES:"/get_files/search_files",GET_FILE:"/get_files/file",GET_THUMBNAIL:"/get_files/thumbnail",GET_FILE_METADATA:"/get_files/file_metadata"},s={NOT_IN_DATABASE:0,SUCCESSFUL:1,ALREADY_IN_DATABASE:2,PREVIOUSLY_DELETED:3,FAILED:4,VETOED:7},a={ADD_TO_LOCAL:0,DELETE_FROM_LOCAL:1,PEND_TO_REPOSITORY:2,RESCIND_PEND_FROM_REPOSITORY:3,PETITION_FROM_REPOSITORY:4,RESCIND_A_PETITION_FROM_REPOSITORY:5},i={POST_URL:0,FILE_URL:2,GALLERY_URL:3,WATCHABLE_URL:4,UNKNOWN_URL:5},n={IMPORT_URLS:0,IMPORT_FILES:1,ADD_TAGS:2,SEARCH_FILES:3,MANAGE_PAGES:4,MANAGE_COOKIES:5},_={Current:0,Pending:1,Deleted:2,Petitioned:3},r={"Gallery downloader":1,"Simple downloader":2,"Hard drive import":3,Petitions:5,"File search":6,"URL downloader":7,Duplicates:8,"Thread watcher":9,"Page of pages":10};class o extends Error{constructor(e){super(e),this.name=this.constructor.name}}class l extends Error{constructor(e){super(e),this.name=this.constructor.name}}class c extends Error{constructor(e){super(e),this.name=this.constructor.name}}class d extends Error{constructor(e){super(e),this.name=this.constructor.name}}class h{constructor(e={}){this.address="address"in e?e.address:h.default_api_address,this.access_key="key"in e?e.key:""}static get default_api_address(){return"http://127.0.0.1:45869"}static get ENDPOINTS(){return t}static get FILE_STATUS(){return s}static get TAG_ACTIONS(){return a}static get URL_TYPE(){return i}static get PERMISSIONS(){return n}static get STATUS_NUMBERS(){return _}static get PAGE_TYPES(){return r}async build_call(e,t,s={}){""!==this.access_key&&("headers"in s&&"Hydrus-Client-API-Access-Key"in s.headers||("headers"in s||(s.headers={}),s.headers["Hydrus-Client-API-Access-Key"]=this.access_key));let a=this.address+t;if("queries"in s){a+="?";for(const e in s.queries)if(s.queries.hasOwnProperty(e)){let t=s.queries[e];"object"==typeof t&&(t=JSON.stringify(t)),a+=e+"="+t+"&"}a=a.substr(0,a.length-1)}a=encodeURI(a);let i="parse"in s?s.parse:"json";const n=await fetch(a,{method:e,headers:s.headers,body:"data"in s?s.data:s.json});if(!n.ok)throw new o(n.statusText);switch(i){case"blob":return await n.blob();case"json":default:return await n.json()}}async api_version(){return await this.build_call("GET",t.API_VERSION)}async api_check(){const{version:e}=await this.api_version();if(e>13)throw new d(`You are using an older version of hydrus.js (13) that may not work with the newer api (${e}). Please check if there is an update available!`);if(13>e)throw new d(`This version of hydrus.js (13) is built for a newer version of the api than what your hydrus installation is currently using (${e}). Please update your hydrus.`)}async session_key(){return await this.build_call("GET",t.SESSION_KEY)}async request_new_permissions(e,s){return await this.build_call("GET",t.REQUEST_NEW_PERMISSIONS,{queries:{name:e,basic_permissions:JSON.stringify(s)}})}async verify_access_key(e=""){const s=""!==e?{headers:{"Hydrus-Client-API-Access-Key":e}}:{};return await this.build_call("GET",t.VERIFY_ACCESS_KEY,s)}async add_file(e){return console.warn("add_file is not tested"),await this.build_call("POST",t.ADD_FILE,"path"in e?{json:{path:e.path}}:{headers:{"Content-Type":"application/octet-stream"},data:e.bytes})}async add_tags(e,s){let a={};if(!("service_names_to_tags"in e)&&!("service_names_to_actions_to_tags"in e))throw new l("You must have at least one 'service_names...' argument");if("object"==typeof s?Object.keys(s).length>1?a.hashes=s:a.hash=s[0]:a.hash=s,"service_names_to_tags"in e&&(a.service_names_to_tags=e.service_names_to_tags),"service_names_to_actions_to_tags"in e&&(a.service_names_to_actions_to_tags=e.service_names_to_actions_to_tags),"add_siblings_and_parents"in e){if(typeof e.add_siblings_and_parents!==boolean)throw new c("value of add_siblings_and_parents is of improper type: expects boolean");a.add_siblings_and_parents=e.add_siblings_and_parents}return await this.build_call("POST",t.ADD_TAGS,{json:a})}async clean_tags(e){return await this.build_call("GET",t.CLEAN_TAGS,{queries:{tags:JSON.stringify(e)}})}async get_tag_services(){return await this.build_call("GET",t.GET_TAG_SERVICES)}async get_url_files(e){return await this.build_call("GET",t.GET_URL_FILES,{queries:{url:e}})}async get_url_info(e,s){return await this.build_call("GET",t.GET_URL_INFO,{queries:{url:e}})}async add_url(e){var s={};if(!("url"in e))throw new l("You must have a url argument");if(s.url=e.url,"destination_page_name"in e&&(s.destination_page_name=e.destination_page_name),"destination_page_key"in e&&(s.destination_page_key=e.destination_page_key),"show_destination_page"in e){if("boolean"!=typeof e.show_destination_page)throw new c("value of show_destination_page is of improper type: expects boolean");s.show_destination_page=e.show_destination_page}if("service_names_to_tags"in e){if("object"!=typeof e.service_names_to_tags)throw new c("value of service_names_to_tags is of improper type: expects object");s.service_names_to_tags=e.service_names_to_tags}return await this.build_call("POST",t.ADD_URL,{json:s})}async associate_url(e,s){let a={};if(!("to_add"in e)&&!("to_delete"in e))throw new l("You must have at least one 'to_delete' or 'to_add' argument");return"to_add"in e&&("object"==typeof e.to_add?Object.keys(e.to_add).length>1?a.urls_to_add=e.to_add:a.url_to_add=e.to_add[0]:a.url_to_add=e.to_add),"to_delete"in e&&("object"==typeof e.to_delete?Object.keys(e.to_delete).length>1?a.urls_to_delete=e.to_delete:a.url_to_delete=e.to_delete[0]:a.url_to_delete=e.to_delete),"object"==typeof s?Object.keys(s).length>1?a.hashes=s:a.hash=s[0]:a.hash=s,await this.build_call("POST",t.ASSOCIATE_URL,{json:a})}async search_files(e,s=!1,a=!1){return await this.build_call("GET",t.SEARCH_FILES,{queries:{tags:JSON.stringify(e),system_inbox:s,system_archive:a}})}async get_file_metadata(e){let s={};if("file_ids"in e&&"hashes"in e)throw new c("only one argument is required, choose either file_ids or hashes");if("file_ids"in e){if("object"!=typeof e.file_ids)throw new c("value of file_ids is of improper type: expects list");s.file_ids=JSON.stringify(e.file_ids)}if("hashes"in e){if("object"!=typeof e.hashes)throw new c("value of hashes is of improper type: expects list");s.hashes=JSON.stringify(e.hashes)}return"only_return_identifiers"in e&&(s.only_return_identifiers=e.only_return_identifiers),console.log(s),await this.build_call("GET",t.GET_FILE_METADATA,{queries:s})}async get_file(e){let s={};if("file_id"in e&&"hash"in e)throw new c("only one argument is required, choose either file_id or hash");return"file_id"in e&&(s.file_id=e.file_id),"hash"in e&&(s.hash=e.hash),await this.build_call("GET",t.GET_FILE,{parse:"blob",queries:s})}async get_thumbnail(e){let s={};if("file_id"in e&&"hash"in e)throw new c("only one argument is required, choose either file_id or hash");return"file_id"in e&&(s.file_id=e.file_id),"hash"in e&&(s.hash=e.hash),await this.build_call("GET",t.GET_THUMBNAIL,{parse:"blob",queries:s})}async get_cookies(e){return await this.build_call("GET",t.GET_COOKIES,{queries:{domain:e}})}async set_cookies(e){return await this.build_call("POST",t.SET_COOKIES,{json:e})}async get_pages(){return await this.build_call("GET",t.GET_PAGES)}async get_page_info(e){var s={};if(!("page_key"in e))throw new c("page_key argument required");return s.page_key=e.page_key,"simple"in e&&(s.simple=e.simple),await this.build_call("GET",t.GET_PAGE_INFO,{queries:s})}async focus_page(e){var s={};if(!("page_key"in e))throw new c("page_key argument required");return s.page_key=e.page_key,await this.build_call("POST",t.FOCUS_PAGE,{json:s})}}h.PERMISSIONS.SEARCH_FILES,h.PERMISSIONS.MANAGE_PAGES;const u=["client/client.e39d24b1.js","client/index.49afe9fc.js","client/TagSearch.49e98083.js","client/index.0ae4a38f.js","client/[slug].0e38ea74.js","client/tags.226a9196.js"].concat(["service-worker-index.html","favicon.png","logo-192.png","logo-512.png","manifest.json","successkid.jpg"]),E=new Set(u);self.addEventListener("install",e=>{e.waitUntil(caches.open("cache1594663747384").then(e=>e.addAll(u)).then(()=>{self.skipWaiting()}))}),self.addEventListener("activate",e=>{e.waitUntil(caches.keys().then(async e=>{for(const t of e)"cache1594663747384"!==t&&await caches.delete(t);self.clients.claim()}))}),self.addEventListener("fetch",t=>{if("GET"!==t.request.method||t.request.headers.has("range"))return;const s=new URL(t.request.url);s.protocol.startsWith("http")&&(s.hostname===self.location.hostname&&s.port!==self.location.port||(s.host===self.location.host&&E.has(s.pathname)?t.respondWith(caches.match(t.request)):s.origin===self.origin&&e.find(e=>e.pattern.test(s.pathname))?t.respondWith(caches.match("/service-worker-index.html")):"only-if-cached"!==t.request.cache&&t.respondWith(caches.open("offline1594663747384").then(async e=>{try{const s=await fetch(t.request);return e.put(t.request,s.clone()),s}catch(s){const a=await e.match(t.request);if(a)return a;throw s}}))))}),addEventListener("message",e=>{})}();
