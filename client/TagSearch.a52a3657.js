import{S as e,i as t,s,b as a,t as i,k as n,c as r,f as _,g as o,m as l,d as c,h as d,a as h,j as u,l as g,u as E,p as f,q as p,D as y,n as S,E as T,r as b,F as m}from"./client.5eb595c1.js";const A={API_VERSION:"/api_version",SESSION_KEY:"/session_key",REQUEST_NEW_PERMISSIONS:"/request_new_permissions",VERIFY_ACCESS_KEY:"/verify_access_key",ADD_FILE:"/add_files/add_file",CLEAN_TAGS:"/add_tags/clean_tags",GET_TAG_SERVICES:"/add_tags/get_tag_services",ADD_TAGS:"/add_tags/add_tags",GET_URL_FILES:"/add_urls/get_url_files",GET_URL_INFO:"/add_urls/get_url_info",ADD_URL:"/add_urls/add_url",ASSOCIATE_URL:"/add_urls/associate_url",GET_COOKIES:"/manage_cookies/get_cookies",SET_COOKIES:"/manage_cookies/set_cookies",GET_PAGES:"/manage_pages/get_pages",GET_PAGE_INFO:"/manage_pages/get_page_info",FOCUS_PAGE:"/manage_pages/focus_page",SEARCH_FILES:"/get_files/search_files",GET_FILE:"/get_files/file",GET_THUMBNAIL:"/get_files/thumbnail",GET_FILE_METADATA:"/get_files/file_metadata"},I={NOT_IN_DATABASE:0,SUCCESSFUL:1,ALREADY_IN_DATABASE:2,PREVIOUSLY_DELETED:3,FAILED:4,VETOED:7},w={ADD_TO_LOCAL:0,DELETE_FROM_LOCAL:1,PEND_TO_REPOSITORY:2,RESCIND_PEND_FROM_REPOSITORY:3,PETITION_FROM_REPOSITORY:4,RESCIND_A_PETITION_FROM_REPOSITORY:5},O={POST_URL:0,FILE_URL:2,GALLERY_URL:3,WATCHABLE_URL:4,UNKNOWN_URL:5},v={IMPORT_URLS:0,IMPORT_FILES:1,ADD_TAGS:2,SEARCH_FILES:3,MANAGE_PAGES:4,MANAGE_COOKIES:5},R={Current:0,Pending:1,Deleted:2,Petitioned:3},G={"Gallery downloader":1,"Simple downloader":2,"Hard drive import":3,Petitions:5,"File search":6,"URL downloader":7,Duplicates:8,"Thread watcher":9,"Page of pages":10};class N extends Error{constructor(e){super(e),this.name=this.constructor.name}}class P extends Error{constructor(e){super(e),this.name=this.constructor.name}}class L extends Error{constructor(e){super(e),this.name=this.constructor.name}}class D extends Error{constructor(e){super(e),this.name=this.constructor.name}}class k{constructor(e={}){this.address="address"in e?e.address:k.default_api_address,this.access_key="key"in e?e.key:""}static get default_api_address(){return"http://127.0.0.1:45869"}static get ENDPOINTS(){return A}static get FILE_STATUS(){return I}static get TAG_ACTIONS(){return w}static get URL_TYPE(){return O}static get PERMISSIONS(){return v}static get STATUS_NUMBERS(){return R}static get PAGE_TYPES(){return G}async build_call(e,t,s={}){""!==this.access_key&&("headers"in s&&"Hydrus-Client-API-Access-Key"in s.headers||("headers"in s||(s.headers={}),s.headers["Hydrus-Client-API-Access-Key"]=this.access_key));let a=this.address+t;if("queries"in s){a+="?";for(const e in s.queries)if(s.queries.hasOwnProperty(e)){let t=s.queries[e];"object"==typeof t&&(t=JSON.stringify(t)),a+=e+"="+t+"&"}a=a.substr(0,a.length-1)}a=encodeURI(a);let i="parse"in s?s.parse:"json";const n=await fetch(a,{method:e,headers:s.headers,body:"data"in s?s.data:s.json});if(!n.ok)throw new N(n.statusText);switch(i){case"blob":return await n.blob();case"json":default:return await n.json()}}async api_version(){return await this.build_call("GET",A.API_VERSION)}async api_check(){const{version:e}=await this.api_version();if(e>13)throw new D(`You are using an older version of hydrus.js (13) that may not work with the newer api (${e}). Please check if there is an update available!`);if(13>e)throw new D(`This version of hydrus.js (13) is built for a newer version of the api than what your hydrus installation is currently using (${e}). Please update your hydrus.`)}async session_key(){return await this.build_call("GET",A.SESSION_KEY)}async request_new_permissions(e,t){return await this.build_call("GET",A.REQUEST_NEW_PERMISSIONS,{queries:{name:e,basic_permissions:JSON.stringify(t)}})}async verify_access_key(e=""){const t=""!==e?{headers:{"Hydrus-Client-API-Access-Key":e}}:{};return await this.build_call("GET",A.VERIFY_ACCESS_KEY,t)}async add_file(e){return console.warn("add_file is not tested"),await this.build_call("POST",A.ADD_FILE,"path"in e?{json:{path:e.path}}:{headers:{"Content-Type":"application/octet-stream"},data:e.bytes})}async add_tags(e,t){let s={};if(!("service_names_to_tags"in e)&&!("service_names_to_actions_to_tags"in e))throw new P("You must have at least one 'service_names...' argument");if("object"==typeof t?Object.keys(t).length>1?s.hashes=t:s.hash=t[0]:s.hash=t,"service_names_to_tags"in e&&(s.service_names_to_tags=e.service_names_to_tags),"service_names_to_actions_to_tags"in e&&(s.service_names_to_actions_to_tags=e.service_names_to_actions_to_tags),"add_siblings_and_parents"in e){if(typeof e.add_siblings_and_parents!==boolean)throw new L("value of add_siblings_and_parents is of improper type: expects boolean");s.add_siblings_and_parents=e.add_siblings_and_parents}return await this.build_call("POST",A.ADD_TAGS,{json:s})}async clean_tags(e){return await this.build_call("GET",A.CLEAN_TAGS,{queries:{tags:JSON.stringify(e)}})}async get_tag_services(){return await this.build_call("GET",A.GET_TAG_SERVICES)}async get_url_files(e){return await this.build_call("GET",A.GET_URL_FILES,{queries:{url:e}})}async get_url_info(e,t){return await this.build_call("GET",A.GET_URL_INFO,{queries:{url:e}})}async add_url(e){var t={};if(!("url"in e))throw new P("You must have a url argument");if(t.url=e.url,"destination_page_name"in e&&(t.destination_page_name=e.destination_page_name),"destination_page_key"in e&&(t.destination_page_key=e.destination_page_key),"show_destination_page"in e){if("boolean"!=typeof e.show_destination_page)throw new L("value of show_destination_page is of improper type: expects boolean");t.show_destination_page=e.show_destination_page}if("service_names_to_tags"in e){if("object"!=typeof e.service_names_to_tags)throw new L("value of service_names_to_tags is of improper type: expects object");t.service_names_to_tags=e.service_names_to_tags}return await this.build_call("POST",A.ADD_URL,{json:t})}async associate_url(e,t){let s={};if(!("to_add"in e)&&!("to_delete"in e))throw new P("You must have at least one 'to_delete' or 'to_add' argument");return"to_add"in e&&("object"==typeof e.to_add?Object.keys(e.to_add).length>1?s.urls_to_add=e.to_add:s.url_to_add=e.to_add[0]:s.url_to_add=e.to_add),"to_delete"in e&&("object"==typeof e.to_delete?Object.keys(e.to_delete).length>1?s.urls_to_delete=e.to_delete:s.url_to_delete=e.to_delete[0]:s.url_to_delete=e.to_delete),"object"==typeof t?Object.keys(t).length>1?s.hashes=t:s.hash=t[0]:s.hash=t,await this.build_call("POST",A.ASSOCIATE_URL,{json:s})}async search_files(e,t=!1,s=!1){return await this.build_call("GET",A.SEARCH_FILES,{queries:{tags:JSON.stringify(e),system_inbox:t,system_archive:s}})}async get_file_metadata(e){let t={};if("file_ids"in e&&"hashes"in e)throw new L("only one argument is required, choose either file_ids or hashes");if("file_ids"in e){if("object"!=typeof e.file_ids)throw new L("value of file_ids is of improper type: expects list");t.file_ids=JSON.stringify(e.file_ids)}if("hashes"in e){if("object"!=typeof e.hashes)throw new L("value of hashes is of improper type: expects list");t.hashes=JSON.stringify(e.hashes)}return"only_return_identifiers"in e&&(t.only_return_identifiers=e.only_return_identifiers),console.log(t),await this.build_call("GET",A.GET_FILE_METADATA,{queries:t})}async get_file(e){let t={};if("file_id"in e&&"hash"in e)throw new L("only one argument is required, choose either file_id or hash");return"file_id"in e&&(t.file_id=e.file_id),"hash"in e&&(t.hash=e.hash),await this.build_call("GET",A.GET_FILE,{parse:"blob",queries:t})}async get_thumbnail(e){let t={};if("file_id"in e&&"hash"in e)throw new L("only one argument is required, choose either file_id or hash");return"file_id"in e&&(t.file_id=e.file_id),"hash"in e&&(t.hash=e.hash),await this.build_call("GET",A.GET_THUMBNAIL,{parse:"blob",queries:t})}async get_cookies(e){return await this.build_call("GET",A.GET_COOKIES,{queries:{domain:e}})}async set_cookies(e){return await this.build_call("POST",A.SET_COOKIES,{json:e})}async get_pages(){return await this.build_call("GET",A.GET_PAGES)}async get_page_info(e){var t={};if(!("page_key"in e))throw new L("page_key argument required");return t.page_key=e.page_key,"simple"in e&&(t.simple=e.simple),await this.build_call("GET",A.GET_PAGE_INFO,{queries:t})}async focus_page(e){var t={};if(!("page_key"in e))throw new L("page_key argument required");return t.page_key=e.page_key,await this.build_call("POST",A.FOCUS_PAGE,{json:t})}}let C,U=["image/jpg","image/png","image/gif"];function F(e){return U.includes(e)}function j(e,t){const s={address:e||M()};return s.key=t||function(){try{return JSON.parse(localStorage.getItem("access_key"))}catch(e){return}}(),C=new k(s),C}function q(e,t){return C||j(e,t),C.fetch=fetch,C}function M(){try{return JSON.parse(localStorage.getItem("address"))}catch(e){return k.default_api_address}}const Y=[k.PERMISSIONS.SEARCH_FILES,k.PERMISSIONS.MANAGE_PAGES];function x(e,t,s){const a=e.slice();return a[8]=t[s],a}function K(e){let t,s,f,p,S,T,b,m,A=e[8]+"";function I(...t){return e[5](e[8],...t)}return{c(){t=a("button"),s=i(A),f=n(),p=a("span"),S=i("×"),this.h()},l(e){t=r(e,"BUTTON",{type:!0,class:!0,title:!0});var a=_(t);s=o(a,A),f=l(a),p=r(a,"SPAN",{class:!0,"aria-hidden":!0});var i=_(p);S=o(i,"×"),i.forEach(c),a.forEach(c),this.h()},h(){d(p,"class","badge"),d(p,"aria-hidden","true"),d(t,"type","button"),d(t,"class","btn btn-secondary btn-sm"),d(t,"title",T="Remove tag '"+e[8]+"'")},m(e,a){h(e,t,a),u(t,s),u(t,f),u(t,p),u(p,S),b||(m=g(t,"click",y(I)),b=!0)},p(a,i){e=a,1&i&&A!==(A=e[8]+"")&&E(s,A),1&i&&T!==(T="Remove tag '"+e[8]+"'")&&d(t,"title",T)},d(e){e&&c(t),b=!1,m()}}}function V(e){let t,s,m,A,I,w,O,v,R,G,N,P,L,D,k,C,U,F,j=e[2].length>0?"Add Tag":"Search",q=e[0],M=[];for(let t=0;t<q.length;t+=1)M[t]=K(x(e,q,t));return{c(){t=a("div"),s=a("form"),m=a("div");for(let e=0;e<M.length;e+=1)M[e].c();A=n(),I=a("input"),w=n(),O=a("button"),v=i(j),G=n(),N=a("div"),P=a("div"),L=a("h3"),D=i("Search Tags"),k=n(),C=a("div"),this.h()},l(e){t=r(e,"DIV",{id:!0});var a=_(t);s=r(a,"FORM",{});var i=_(s);m=r(i,"DIV",{class:!0});var n=_(m);for(let e=0;e<M.length;e+=1)M[e].l(n);A=l(n),I=r(n,"INPUT",{type:!0,class:!0,placeholder:!0,"aria-label":!0,"aria-describedby":!0}),w=l(n),O=r(n,"BUTTON",{class:!0,type:!0,id:!0,disabled:!0});var d=_(O);v=o(d,j),d.forEach(c),n.forEach(c),G=l(i),N=r(i,"DIV",{id:!0,class:!0});var h=_(N);P=r(h,"DIV",{id:!0,class:!0});var u=_(P);L=r(u,"H3",{class:!0});var g=_(L);D=o(g,"Search Tags"),g.forEach(c),u.forEach(c),k=l(h),C=r(h,"DIV",{id:!0,class:!0}),_(C).forEach(c),h.forEach(c),i.forEach(c),a.forEach(c),this.h()},h(){d(I,"type","text"),d(I,"class","form-control"),d(I,"placeholder","tag:to add"),d(I,"aria-label","Tag to add to search query"),d(I,"aria-describedby","add-tag"),d(O,"class","btn"),d(O,"type","submit"),d(O,"id","search"),O.disabled=R=0===e[0].length&&0===e[2].length,f(O,"btn-success",0===e[2].length&&e[0].length>0),f(O,"btn-primary",e[2].length>0),f(O,"disabled",0===e[2].length&&0===e[0].length),d(m,"class","input-group"),d(L,"class","sr-only sr-only-focusable"),d(P,"id","tags"),d(P,"class","col"),d(C,"id","action"),d(C,"class","col-auto text-center"),d(N,"id","query"),d(N,"class","row"),d(t,"id","search")},m(a,i){h(a,t,i),u(t,s),u(s,m);for(let e=0;e<M.length;e+=1)M[e].m(m,null);u(m,A),u(m,I),p(I,e[2]),u(m,w),u(m,O),u(O,v),u(s,G),u(s,N),u(N,P),u(P,L),u(L,D),u(N,k),u(N,C),U||(F=[g(I,"input",e[6]),g(s,"submit",y(e[7]))],U=!0)},p(e,[t]){if(17&t){let s;for(q=e[0],s=0;s<q.length;s+=1){const a=x(e,q,s);M[s]?M[s].p(a,t):(M[s]=K(a),M[s].c(),M[s].m(m,A))}for(;s<M.length;s+=1)M[s].d(1);M.length=q.length}4&t&&I.value!==e[2]&&p(I,e[2]),4&t&&j!==(j=e[2].length>0?"Add Tag":"Search")&&E(v,j),5&t&&R!==(R=0===e[0].length&&0===e[2].length)&&(O.disabled=R),5&t&&f(O,"btn-success",0===e[2].length&&e[0].length>0),4&t&&f(O,"btn-primary",e[2].length>0),5&t&&f(O,"disabled",0===e[2].length&&0===e[0].length)},i:S,o:S,d(e){e&&c(t),T(M,e),U=!1,b(F)}}}function H(e,t,s){let{tags:a=["landscape"]}=t,i="";function n(){console.log(i),a.includes(i)||(a.push(i),s(0,a)),s(2,i="")}function r(e){const t=a.indexOf(String(e));console.log(e,t),a.splice(t,1),s(0,a)}let{onSearch:_=(e=>{m("/tags?q="+JSON.stringify(e))})}=t;return e.$set=e=>{"tags"in e&&s(0,a=e.tags),"onSearch"in e&&s(1,_=e.onSearch)},[a,_,i,n,r,e=>{r(e)},function(){i=this.value,s(2,i)},()=>{i.length>0?n():_(a)}]}class J extends e{constructor(e){super(),t(this,e,H,V,s,{tags:0,onSearch:1})}}export{q as G,F as I,J as T,Y as r};
