import{S as e,i as t,s,e as a,c as i,a as n,d as r,f as o,g as l,h as _,J as c,j as d,m as u,K as h,L as g,B as p,C as f,v as E,H as y,t as S,b as m,l as T,r as b,o as I,p as w,q as O,n as A,M as v,u as R,N as G}from"./client.449b79cd.js";const N={API_VERSION:"/api_version",SESSION_KEY:"/session_key",REQUEST_NEW_PERMISSIONS:"/request_new_permissions",VERIFY_ACCESS_KEY:"/verify_access_key",ADD_FILE:"/add_files/add_file",CLEAN_TAGS:"/add_tags/clean_tags",GET_TAG_SERVICES:"/add_tags/get_tag_services",ADD_TAGS:"/add_tags/add_tags",GET_URL_FILES:"/add_urls/get_url_files",GET_URL_INFO:"/add_urls/get_url_info",ADD_URL:"/add_urls/add_url",ASSOCIATE_URL:"/add_urls/associate_url",GET_COOKIES:"/manage_cookies/get_cookies",SET_COOKIES:"/manage_cookies/set_cookies",GET_PAGES:"/manage_pages/get_pages",GET_PAGE_INFO:"/manage_pages/get_page_info",FOCUS_PAGE:"/manage_pages/focus_page",SEARCH_FILES:"/get_files/search_files",GET_FILE:"/get_files/file",GET_THUMBNAIL:"/get_files/thumbnail",GET_FILE_METADATA:"/get_files/file_metadata"},P={NOT_IN_DATABASE:0,SUCCESSFUL:1,ALREADY_IN_DATABASE:2,PREVIOUSLY_DELETED:3,FAILED:4,VETOED:7},L={ADD_TO_LOCAL:0,DELETE_FROM_LOCAL:1,PEND_TO_REPOSITORY:2,RESCIND_PEND_FROM_REPOSITORY:3,PETITION_FROM_REPOSITORY:4,RESCIND_A_PETITION_FROM_REPOSITORY:5},k={POST_URL:0,FILE_URL:2,GALLERY_URL:3,WATCHABLE_URL:4,UNKNOWN_URL:5},D={IMPORT_URLS:0,IMPORT_FILES:1,ADD_TAGS:2,SEARCH_FILES:3,MANAGE_PAGES:4,MANAGE_COOKIES:5},j={Current:0,Pending:1,Deleted:2,Petitioned:3},C={"Gallery downloader":1,"Simple downloader":2,"Hard drive import":3,Petitions:5,"File search":6,"URL downloader":7,Duplicates:8,"Thread watcher":9,"Page of pages":10};class U extends Error{constructor(e){super(e),this.name=this.constructor.name}}class F extends Error{constructor(e){super(e),this.name=this.constructor.name}}class x extends Error{constructor(e){super(e),this.name=this.constructor.name}}class q extends Error{constructor(e){super(e),this.name=this.constructor.name}}class M{constructor(e={}){this.address="address"in e?e.address:M.default_api_address,this.access_key="key"in e?e.key:""}static get default_api_address(){return"http://127.0.0.1:45869"}static get ENDPOINTS(){return N}static get FILE_STATUS(){return P}static get TAG_ACTIONS(){return L}static get URL_TYPE(){return k}static get PERMISSIONS(){return D}static get STATUS_NUMBERS(){return j}static get PAGE_TYPES(){return C}async build_call(e,t,s={}){""!==this.access_key&&("headers"in s&&"Hydrus-Client-API-Access-Key"in s.headers||("headers"in s||(s.headers={}),s.headers["Hydrus-Client-API-Access-Key"]=this.access_key));let a=this.address+t;if("queries"in s){a+="?";for(const e in s.queries)if(s.queries.hasOwnProperty(e)){let t=s.queries[e];"object"==typeof t&&(t=JSON.stringify(t)),a+=e+"="+t+"&"}a=a.substr(0,a.length-1)}a=encodeURI(a);let i="parse"in s?s.parse:"json";const n=await fetch(a,{method:e,headers:s.headers,body:"data"in s?s.data:s.json});if(!n.ok)throw new U(n.statusText);switch(i){case"blob":return await n.blob();case"json":default:return await n.json()}}async api_version(){return await this.build_call("GET",N.API_VERSION)}async api_check(){const{version:e}=await this.api_version();if(e>13)throw new q(`You are using an older version of hydrus.js (13) that may not work with the newer api (${e}). Please check if there is an update available!`);if(13>e)throw new q(`This version of hydrus.js (13) is built for a newer version of the api than what your hydrus installation is currently using (${e}). Please update your hydrus.`)}async session_key(){return await this.build_call("GET",N.SESSION_KEY)}async request_new_permissions(e,t){return await this.build_call("GET",N.REQUEST_NEW_PERMISSIONS,{queries:{name:e,basic_permissions:JSON.stringify(t)}})}async verify_access_key(e=""){const t=""!==e?{headers:{"Hydrus-Client-API-Access-Key":e}}:{};return await this.build_call("GET",N.VERIFY_ACCESS_KEY,t)}async add_file(e){return console.warn("add_file is not tested"),await this.build_call("POST",N.ADD_FILE,"path"in e?{json:{path:e.path}}:{headers:{"Content-Type":"application/octet-stream"},data:e.bytes})}async add_tags(e,t){let s={};if(!("service_names_to_tags"in e)&&!("service_names_to_actions_to_tags"in e))throw new F("You must have at least one 'service_names...' argument");if("object"==typeof t?Object.keys(t).length>1?s.hashes=t:s.hash=t[0]:s.hash=t,"service_names_to_tags"in e&&(s.service_names_to_tags=e.service_names_to_tags),"service_names_to_actions_to_tags"in e&&(s.service_names_to_actions_to_tags=e.service_names_to_actions_to_tags),"add_siblings_and_parents"in e){if(typeof e.add_siblings_and_parents!==boolean)throw new x("value of add_siblings_and_parents is of improper type: expects boolean");s.add_siblings_and_parents=e.add_siblings_and_parents}return await this.build_call("POST",N.ADD_TAGS,{json:s})}async clean_tags(e){return await this.build_call("GET",N.CLEAN_TAGS,{queries:{tags:JSON.stringify(e)}})}async get_tag_services(){return await this.build_call("GET",N.GET_TAG_SERVICES)}async get_url_files(e){return await this.build_call("GET",N.GET_URL_FILES,{queries:{url:e}})}async get_url_info(e,t){return await this.build_call("GET",N.GET_URL_INFO,{queries:{url:e}})}async add_url(e){var t={};if(!("url"in e))throw new F("You must have a url argument");if(t.url=e.url,"destination_page_name"in e&&(t.destination_page_name=e.destination_page_name),"destination_page_key"in e&&(t.destination_page_key=e.destination_page_key),"show_destination_page"in e){if("boolean"!=typeof e.show_destination_page)throw new x("value of show_destination_page is of improper type: expects boolean");t.show_destination_page=e.show_destination_page}if("service_names_to_tags"in e){if("object"!=typeof e.service_names_to_tags)throw new x("value of service_names_to_tags is of improper type: expects object");t.service_names_to_tags=e.service_names_to_tags}return await this.build_call("POST",N.ADD_URL,{json:t})}async associate_url(e,t){let s={};if(!("to_add"in e)&&!("to_delete"in e))throw new F("You must have at least one 'to_delete' or 'to_add' argument");return"to_add"in e&&("object"==typeof e.to_add?Object.keys(e.to_add).length>1?s.urls_to_add=e.to_add:s.url_to_add=e.to_add[0]:s.url_to_add=e.to_add),"to_delete"in e&&("object"==typeof e.to_delete?Object.keys(e.to_delete).length>1?s.urls_to_delete=e.to_delete:s.url_to_delete=e.to_delete[0]:s.url_to_delete=e.to_delete),"object"==typeof t?Object.keys(t).length>1?s.hashes=t:s.hash=t[0]:s.hash=t,await this.build_call("POST",N.ASSOCIATE_URL,{json:s})}async search_files(e,t=!1,s=!1){return await this.build_call("GET",N.SEARCH_FILES,{queries:{tags:JSON.stringify(e),system_inbox:t,system_archive:s}})}async get_file_metadata(e){let t={};if("file_ids"in e&&"hashes"in e)throw new x("only one argument is required, choose either file_ids or hashes");if("file_ids"in e){if("object"!=typeof e.file_ids)throw new x("value of file_ids is of improper type: expects list");t.file_ids=JSON.stringify(e.file_ids)}if("hashes"in e){if("object"!=typeof e.hashes)throw new x("value of hashes is of improper type: expects list");t.hashes=JSON.stringify(e.hashes)}return"only_return_identifiers"in e&&(t.only_return_identifiers=e.only_return_identifiers),console.log(t),await this.build_call("GET",N.GET_FILE_METADATA,{queries:t})}async get_file(e){let t={};if("file_id"in e&&"hash"in e)throw new x("only one argument is required, choose either file_id or hash");return"file_id"in e&&(t.file_id=e.file_id),"hash"in e&&(t.hash=e.hash),await this.build_call("GET",N.GET_FILE,{parse:"blob",queries:t})}async get_thumbnail(e){let t={};if("file_id"in e&&"hash"in e)throw new x("only one argument is required, choose either file_id or hash");return"file_id"in e&&(t.file_id=e.file_id),"hash"in e&&(t.hash=e.hash),await this.build_call("GET",N.GET_THUMBNAIL,{parse:"blob",queries:t})}async get_cookies(e){return await this.build_call("GET",N.GET_COOKIES,{queries:{domain:e}})}async set_cookies(e){return await this.build_call("POST",N.SET_COOKIES,{json:e})}async get_pages(){return await this.build_call("GET",N.GET_PAGES)}async get_page_info(e){var t={};if(!("page_key"in e))throw new x("page_key argument required");return t.page_key=e.page_key,"simple"in e&&(t.simple=e.simple),await this.build_call("GET",N.GET_PAGE_INFO,{queries:t})}async focus_page(e){var t={};if(!("page_key"in e))throw new x("page_key argument required");return t.page_key=e.page_key,await this.build_call("POST",N.FOCUS_PAGE,{json:t})}}let Y,V=["image/jpg","image/png","image/gif"];function K(e){return V.includes(e)}function H(e,t){const s={address:e||J()};return s.key=t||function(){try{return JSON.parse(localStorage.getItem("access_key"))}catch(e){return}}(),Y=new M(s),Y.fetch=fetch,Y}function $(e,t){return(e||t||!Y)&&H(e,t),Y}function J(){try{return JSON.parse(localStorage.getItem("address"))}catch(e){return M.default_api_address}}const B=[M.PERMISSIONS.SEARCH_FILES,M.PERMISSIONS.MANAGE_PAGES];function W(e){let t,s,c;return{c(){t=a("div"),s=a("video"),this.h()},l(e){t=i(e,"DIV",{class:!0});var a=n(t);s=i(a,"VIDEO",{preload:!0,autobuffer:!0,autoplay:!0,muted:!0,loop:!0,playsinline:!0,src:!0,class:!0}),n(s).forEach(r),a.forEach(r),this.h()},h(){o(s,"preload",""),o(s,"autobuffer",""),s.autoplay=!0,s.muted=!0,s.loop=!0,s.playsInline=!0,s.src!==(c=e[1].video)&&o(s,"src",c),o(s,"class","svelte-1jxpqpn"),o(t,"class","video-stage svelte-1jxpqpn")},m(a,i){l(a,t,i),_(t,s),e[9](s)},p(e,t){2&t&&s.src!==(c=e[1].video)&&o(s,"src",c)},d(s){s&&r(t),e[9](null)}}}function Q(e){let t,s,E,y,S,m=!!e[1].video&&W(e);const T=e[8].default,b=c(T,e,e[7],null);return{c(){t=a("section"),m&&m.c(),s=d(),E=a("div"),y=a("div"),b&&b.c(),this.h()},l(e){t=i(e,"SECTION",{style:!0,class:!0});var a=n(t);m&&m.l(a),s=u(a),E=i(a,"DIV",{class:!0});var o=n(E);y=i(o,"DIV",{class:!0,style:!0});var l=n(y);b&&b.l(l),l.forEach(r),o.forEach(r),a.forEach(r),this.h()},h(){o(y,"class","row"),h(y,"justify-content",e[3]),o(E,"class","container svelte-1jxpqpn"),h(t,"background-color",e[1].color),h(t,"background-image",e[1].image),h(t,"min-height",e[0]),h(t,"color",e[1].text_color),h(t,"text-shadow",e[2]),h(t,"background-position",e[1].image_position),h(t,"--page-padding",e[4]),o(t,"class","svelte-1jxpqpn")},m(a,i){l(a,t,i),m&&m.m(t,null),_(t,s),_(t,E),_(E,y),b&&b.m(y,null),e[10](t),S=!0},p(e,[a]){e[1].video?m?m.p(e,a):(m=W(e),m.c(),m.m(t,s)):m&&(m.d(1),m=null),b&&b.p&&128&a&&g(b,T,e,e[7],a,null,null),(!S||8&a)&&h(y,"justify-content",e[3]),(!S||2&a)&&h(t,"background-color",e[1].color),(!S||2&a)&&h(t,"background-image",e[1].image),(!S||1&a)&&h(t,"min-height",e[0]),(!S||2&a)&&h(t,"color",e[1].text_color),(!S||4&a)&&h(t,"text-shadow",e[2]),(!S||2&a)&&h(t,"background-position",e[1].image_position),(!S||16&a)&&h(t,"--page-padding",e[4])},i(e){S||(p(b,e),S=!0)},o(e){f(b,e),S=!1},d(s){s&&r(t),m&&m.d(),b&&b.d(s),e[10](null)}}}function z(e,t,s){let a,i,{min_height:n=""}=t,{background:r={video:null,image:null,image_position:null,color:null,text_color:null}}=t,{text_shadow:o}=t,{justify:l}=t,{page_padding:_="6rem"}=t;E(()=>{const e=new IntersectionObserver(e=>{e[0].isIntersecting?a&&a.play():e[0].isIntersecting||a&&a.pause()});return e.observe(i),()=>{e.disconnect()}});let{$$slots:c={},$$scope:d}=t;return e.$set=e=>{"min_height"in e&&s(0,n=e.min_height),"background"in e&&s(1,r=e.background),"text_shadow"in e&&s(2,o=e.text_shadow),"justify"in e&&s(3,l=e.justify),"page_padding"in e&&s(4,_=e.page_padding),"$$scope"in e&&s(7,d=e.$$scope)},[n,r,o,l,_,a,i,d,c,function(e){y[e?"unshift":"push"](()=>{a=e,s(5,a)})},function(e){y[e?"unshift":"push"](()=>{i=e,s(6,i)})}]}class X extends e{constructor(e){super(),t(this,e,z,Q,s,{min_height:0,background:1,text_shadow:2,justify:3,page_padding:4})}}function Z(e,t,s){const a=e.slice();return a[8]=t[s],a}function ee(e){let t,s,c,h,g,p,f,E,y=e[8]+"";function w(...t){return e[5](e[8],...t)}return{c(){t=a("button"),s=S(y),c=d(),h=a("span"),g=S("×"),this.h()},l(e){t=i(e,"BUTTON",{type:!0,class:!0,title:!0});var a=n(t);s=m(a,y),c=u(a),h=i(a,"SPAN",{class:!0,"aria-hidden":!0});var o=n(h);g=m(o,"×"),o.forEach(r),a.forEach(r),this.h()},h(){o(h,"class","badge"),o(h,"aria-hidden","true"),o(t,"type","button"),o(t,"class","btn btn-secondary btn-sm"),o(t,"title",p="Remove tag '"+e[8]+"'")},m(e,a){l(e,t,a),_(t,s),_(t,c),_(t,h),_(h,g),f||(E=T(t,"click",b(w)),f=!0)},p(a,i){e=a,1&i&&y!==(y=e[8]+"")&&I(s,y),1&i&&p!==(p="Remove tag '"+e[8]+"'")&&o(t,"title",p)},d(e){e&&r(t),f=!1,E()}}}function te(e){let t,s,c,h,g,p,f,E,y,G,N,P,L,k,D,j,C,U,F=e[2].length>0?"Add Tag":"Search",x=e[0],q=[];for(let t=0;t<x.length;t+=1)q[t]=ee(Z(e,x,t));return{c(){t=a("section"),s=a("form"),c=a("div");for(let e=0;e<q.length;e+=1)q[e].c();h=d(),g=a("input"),p=d(),f=a("button"),E=S(F),G=d(),N=a("div"),P=a("div"),L=a("h3"),k=S("Search Tags"),D=d(),j=a("div"),this.h()},l(e){t=i(e,"SECTION",{id:!0,class:!0});var a=n(t);s=i(a,"FORM",{});var o=n(s);c=i(o,"DIV",{class:!0});var l=n(c);for(let e=0;e<q.length;e+=1)q[e].l(l);h=u(l),g=i(l,"INPUT",{type:!0,class:!0,placeholder:!0,"aria-label":!0,"aria-describedby":!0}),p=u(l),f=i(l,"BUTTON",{class:!0,type:!0,id:!0,disabled:!0});var _=n(f);E=m(_,F),_.forEach(r),l.forEach(r),G=u(o),N=i(o,"DIV",{id:!0,class:!0});var d=n(N);P=i(d,"DIV",{id:!0,class:!0});var y=n(P);L=i(y,"H3",{class:!0});var S=n(L);k=m(S,"Search Tags"),S.forEach(r),y.forEach(r),D=u(d),j=i(d,"DIV",{id:!0,class:!0}),n(j).forEach(r),d.forEach(r),o.forEach(r),a.forEach(r),this.h()},h(){o(g,"type","text"),o(g,"class","form-control"),o(g,"placeholder","tag:to add"),o(g,"aria-label","Tag to add to search query"),o(g,"aria-describedby","add-tag"),o(f,"class","btn"),o(f,"type","submit"),o(f,"id","search"),f.disabled=y=0===e[0].length&&0===e[2].length,w(f,"btn-success",0===e[2].length&&e[0].length>0),w(f,"btn-primary",e[2].length>0),w(f,"disabled",0===e[2].length&&0===e[0].length),o(c,"class","input-group"),o(L,"class","sr-only sr-only-focusable"),o(P,"id","tags"),o(P,"class","col"),o(j,"id","action"),o(j,"class","col-auto text-center"),o(N,"id","query"),o(N,"class","row"),o(t,"id","search"),o(t,"class","container")},m(a,i){l(a,t,i),_(t,s),_(s,c);for(let e=0;e<q.length;e+=1)q[e].m(c,null);_(c,h),_(c,g),O(g,e[2]),_(c,p),_(c,f),_(f,E),_(s,G),_(s,N),_(N,P),_(P,L),_(L,k),_(N,D),_(N,j),C||(U=[T(g,"input",e[6]),T(s,"submit",b(e[7]))],C=!0)},p(e,[t]){if(17&t){let s;for(x=e[0],s=0;s<x.length;s+=1){const a=Z(e,x,s);q[s]?q[s].p(a,t):(q[s]=ee(a),q[s].c(),q[s].m(c,h))}for(;s<q.length;s+=1)q[s].d(1);q.length=x.length}4&t&&g.value!==e[2]&&O(g,e[2]),4&t&&F!==(F=e[2].length>0?"Add Tag":"Search")&&I(E,F),5&t&&y!==(y=0===e[0].length&&0===e[2].length)&&(f.disabled=y),5&t&&w(f,"btn-success",0===e[2].length&&e[0].length>0),4&t&&w(f,"btn-primary",e[2].length>0),5&t&&w(f,"disabled",0===e[2].length&&0===e[0].length)},i:A,o:A,d(e){e&&r(t),v(q,e),C=!1,R(U)}}}function se(e,t,s){let{tags:a=["landscape"]}=t,i="";function n(){console.log(i),a.includes(i)||(a.push(i),s(0,a)),s(2,i="")}function r(e){const t=a.indexOf(String(e));console.log(e,t),a.splice(t,1),s(0,a)}let{onSearch:o=(e=>{G("/tags?q="+JSON.stringify(e))})}=t;return e.$set=e=>{"tags"in e&&s(0,a=e.tags),"onSearch"in e&&s(1,o=e.onSearch)},[a,o,i,n,r,e=>{r(e)},function(){i=this.value,s(2,i)},()=>{i.length>0?n():o(a)}]}class ae extends e{constructor(e){super(),t(this,e,se,te,s,{tags:0,onSearch:1})}}export{$ as G,K as I,X as P,ae as T,B as r};
